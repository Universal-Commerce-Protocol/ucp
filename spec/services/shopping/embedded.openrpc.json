{
  "openrpc": "1.3.2",
  "info": {
    "title": "Embedded Protocol",
    "description": "Embedded Protocol (EP) methods for UCP capabilities. Methods are sent from Merchant to Host via postMessage/JSON-RPC 2.0. Method prefixes indicate capability scope: ec.* (checkout). Future capabilities may define additional prefixes (e.g., eo.* for order).",
    "version": "2026-01-11"
  },
  "x-delegations": [
    "fulfillment.address_change",
    "payment.credential",
    "payment.instruments_change"
  ],
  "methods": [
    {
      "name": "ec.ready",
      "summary": "Handshake from merchant to host",
      "description": "Initiates the Embedded Checkout Protocol. Merchant declares which delegations it accepts, host responds with optional channel upgrade and initial checkout state.",
      "params": [
        {
          "name": "delegate",
          "required": true,
          "schema": {
            "type": "array",
            "description": "Delegation types the merchant accepts. Must be subset of checkout.embedded.delegations.",
            "items": {
              "type": "string",
              "pattern": "^[a-z_]+(?:\\.[a-z_]+)*$"
            },
            "uniqueItems": true
          },
          "description": "Delegation types the merchant accepts. Must be subset of checkout.embedded.delegations."
        }
      ],
      "result": {
        "name": "readyResult",
        "schema": {
          "type": "object",
          "description": "Handshake response from host.",
          "properties": {
            "upgrade": {
              "type": "object",
              "description": "Channel upgrade instructions. If present, switch to provided MessagePort.",
              "properties": {
                "port": {
                  "type": "object",
                  "description": "MessagePort for upgraded channel. Runtime type is MessagePort."
                }
              }
            },
            "checkout": {
              "$ref": "../../schemas/shopping/checkout_resp.json",
              "description": "Initial checkout state with host-provided data (saved instruments, addresses)."
            }
          }
        }
      }
    },
    {
      "name": "ec.start",
      "summary": "Checkout visible to buyer",
      "description": "Merchant notifies host that checkout UI is visible and ready for interaction. Sent after successful ec.ready handshake.",
      "params": [
        {
          "name": "checkout",
          "required": true,
          "schema": {
            "$ref": "../../schemas/shopping/checkout_resp.json",
            "description": "Current checkout state."
          },
          "description": "Current checkout state."
        }
      ]
    },
    {
      "name": "ec.complete",
      "summary": "Checkout completed successfully",
      "description": "Merchant notifies host that order has been placed successfully.",
      "params": [
        {
          "name": "checkout",
          "required": true,
          "schema": {
            "$ref": "../../schemas/shopping/checkout_resp.json",
            "description": "Final checkout state."
          },
          "description": "Final checkout state."
        }
      ]
    },
    {
      "name": "ec.messages.change",
      "summary": "Checkout messages changed",
      "description": "Merchant notifies host that checkout.messages has changed. Includes errors, warnings, and info. Host should update UI accordingly.",
      "params": [
        {
          "name": "checkout",
          "required": true,
          "schema": {
            "$ref": "../../schemas/shopping/checkout_resp.json",
            "description": "Current checkout state with updated messages."
          },
          "description": "Current checkout state with updated messages."
        }
      ]
    },
    {
      "name": "ec.line_items.change",
      "summary": "Line items changed",
      "description": "Merchant notifies host that checkout.line_items has changed (item added, removed, quantity updated).",
      "params": [
        {
          "name": "checkout",
          "required": true,
          "schema": {
            "$ref": "../../schemas/shopping/checkout_resp.json",
            "description": "Current checkout state with updated line items."
          },
          "description": "Current checkout state with updated line items."
        }
      ]
    },
    {
      "name": "ec.buyer.change",
      "summary": "Buyer information changed",
      "description": "Merchant notifies host that checkout.buyer has changed (email, phone, address updated).",
      "params": [
        {
          "name": "checkout",
          "required": true,
          "schema": {
            "$ref": "../../schemas/shopping/checkout_resp.json",
            "description": "Current checkout state with updated buyer."
          },
          "description": "Current checkout state with updated buyer."
        }
      ]
    },
    {
      "name": "ec.payment.change",
      "summary": "Payment state changed",
      "description": "Merchant notifies host that checkout.payment has changed (instrument selected, status updated).",
      "params": [
        {
          "name": "checkout",
          "required": true,
          "schema": {
            "$ref": "../../schemas/shopping/checkout_resp.json",
            "description": "Current checkout state with updated payment."
          },
          "description": "Current checkout state with updated payment."
        }
      ]
    },
    {
      "name": "ec.payment.instruments_change_request",
      "summary": "Request payment instrument change",
      "description": "Merchant requests host to present payment instrument selection UI for the buyer to change their payment method.",
      "params": [
        {
          "name": "checkout",
          "required": true,
          "schema": {
            "$ref": "../../schemas/shopping/checkout_resp.json",
            "description": "Current checkout state."
          },
          "description": "Current checkout state."
        }
      ],
      "result": {
        "name": "instrumentsChangeResult",
        "schema": {
          "type": "object",
          "description": "Checkout state after instrument selection.",
          "required": [
            "checkout"
          ],
          "properties": {
            "checkout": {
              "type": "object",
              "description": "Partial checkout update with payment instrument selection.",
              "properties": {
                "payment": {
                  "type": "object",
                  "properties": {
                    "selected_instrument_id": {
                      "type": "string",
                      "description": "ID of the selected payment instrument."
                    },
                    "instruments": {
                      "type": "array",
                      "items": {
                        "$ref": "../../schemas/shopping/types/payment_instrument.json"
                      },
                      "description": "Available payment instruments after selection."
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "ec.payment.credential_request",
      "summary": "Request payment credential",
      "description": "Merchant requests host to collect payment credential for selected instrument (CVV, 3DS, wallet confirmation).",
      "params": [
        {
          "name": "checkout",
          "required": true,
          "schema": {
            "$ref": "../../schemas/shopping/checkout_resp.json",
            "description": "Current checkout state with selected instrument."
          },
          "description": "Current checkout state with selected instrument."
        }
      ],
      "result": {
        "name": "credentialResult",
        "schema": {
          "type": "object",
          "description": "Checkout state with payment credential ready for completion.",
          "required": [
            "checkout"
          ],
          "properties": {
            "checkout": {
              "type": "object",
              "description": "Partial checkout update with payment credential.",
              "properties": {
                "payment": {
                  "type": "object",
                  "properties": {
                    "instruments": {
                      "type": "array",
                      "items": {
                        "$ref": "../../schemas/shopping/types/payment_instrument.json"
                      },
                      "description": "Payment instruments with credential populated on selected instrument."
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "ect.ready",
      "summary": "Handshake from business to host",
      "description": "Initiates the Embedded Cart Protocol. Business declares whether or not additional auth exchange is needed, host responds with optional channel upgrade and initial cart state if not additional auth exchange is needed.",
      "params": [
        {
          "name": "require_auth",
          "required": true,
          "schema": {
            "type": "boolean",
            "description": "Whether or not business requires additional auth exchange from host. Needed when identity linking is a pre-requisite."
          },
          "description": "Whether or not business requires additional auth exchange from host. Needed when identity linking is a pre-requisite."
        }
      ],
      "result": {
        "name": "readyResult",
        "schema": {
          "type": "object",
          "description": "Handshake response from host.",
          "properties": {
            "upgrade": {
              "type": "object",
              "description": "Channel upgrade instructions. If present, switch to provided MessagePort.",
              "properties": {
                "port": {
                  "type": "object",
                  "description": "MessagePort for upgraded channel. Runtime type is MessagePort."
                }
              }
            },
            "cart": {
              "$ref": "../../schemas/shopping/cart_resp.json",
              "description": "Optional cart state with host-provided data (line_items)."
            }
          }
        }
      }
    },
    {
      "name": "ect.auth",
      "summary": "Handshake from host to business",
      "description": "Augments Embedded Cart Protocol by doing an additional auth exchanges per business requirement.",
      "params": [
        {
          "name": "authorization",
          "required": true,
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "cart",
          "required": false,
          "schema": {
            "$ref": "../../schemas/shopping/cart_resp.json",
            "description": "Optional cart state with host-provided data (line_items)."
          },
          "description": "Optional cart state with host-provided data (line_items)."
        }
      ]
    },
    {
      "name": "ect.start",
      "summary": "Cart visible to buyer",
      "description": "Business notifies host that checkout UI is visible and ready for interaction.",
      "params": [
        {
          "name": "cart",
          "required": true,
          "schema": {
            "$ref": "../../schemas/shopping/cart_resp.json",
            "description": "Current cart state."
          },
          "description": "Current cart state."
        }
      ]
    },
    {
      "name": "ect.transition.checkout",
      "summary": "Cart successfully transitioned into a checkout session.",
      "description": "Business notifies host that basket building has completed and buyer is seamlessly transitioning to the Embedded Checkout Protocol.",
      "params": [
        {
          "name": "cart",
          "required": true,
          "schema": {
            "$ref": "../../schemas/shopping/cart_resp.json",
            "description": "Final cart state before transitioning to checkout."
          },
          "description": "Final cart state before transitioning to checkout."
        },
        {
          "name": "checkout",
          "required": true,
          "schema": {
            "$ref": "../../schemas/shopping/checkout_resp.json",
            "description": "Initial checkout session that is visible to buyer and ready for interaction."
          },
          "description": "Initial checkout session that is visible to buyer and ready for interaction."
        }
      ]
    },
    {
      "name": "ect.line_items.change_request",
      "summary": "Request line item change validation",
      "description": "Business notifies host that cart.line_items has changed (item added, removed, quantity updated) and requests host to validate change request.",
      "params": [
        {
          "name": "cart",
          "required": true,
          "schema": {
            "$ref": "../../schemas/shopping/cart_resp.json",
            "description": "Current cart state with updated line items."
          },
          "description": "Current cart state with updated line items."
        }
      ],
      "result": {
        "name": "changeResult",
        "schema": {
          "type": "object",
          "description": "Cart state after line item update validation.",
          "required": [
            "cart"
          ],
          "properties": {
            "cart": {
              "type": "object",
              "description": "Partial cart update with line items.",
              "properties": {
                "line_items": {
                  "type": "array",
                  "items": {
                    "$ref": "types/line_item.json"
                  },
                  "description": "Cart line items after passing host validations."
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "ect.line_items.change",
      "summary": "Line items changed",
      "description": "Business notifies host that cart.line_items has changed (item added, removed, quantity updated).",
      "params": [
        {
          "name": "cart",
          "required": true,
          "schema": {
            "$ref": "../../schemas/shopping/cart_resp.json",
            "description": "Current cart state with updated line items."
          },
          "description": "Current cart state with updated line items."
        }
      ]
    },
    {
      "name": "ect.buyer.change",
      "summary": "Buyer information changed",
      "description": "Business notifies host that cart.buyer has changed (email, phone, address updated).",
      "params": [
        {
          "name": "cart",
          "required": true,
          "schema": {
            "$ref": "../../schemas/shopping/cart_resp.json",
            "description": "Current cart state with updated buyer."
          },
          "description": "Current cart state with updated buyer."
        }
      ]
    },
    {
      "name": "ect.context.change",
      "summary": "Buyer context changed",
      "description": "Business notifies host that cart.context (localization signals) has changed.",
      "params": [
        {
          "name": "cart",
          "required": true,
          "schema": {
            "$ref": "../../schemas/shopping/cart_resp.json",
            "description": "Current cart state with updated context."
          },
          "description": "Current cart state with updated context."
        }
      ]
    },
    {
      "name": "ect.messages.change",
      "summary": "Cart messages changed",
      "description": "Business notifies host that cart.messages has changed. Includes errors, warnings, and info. Host should update UI accordingly.",
      "params": [
        {
          "name": "cart",
          "required": true,
          "schema": {
            "$ref": "../../schemas/shopping/cart_resp.json",
            "description": "Current cart state with updated messages."
          },
          "description": "Current cart state with updated messages."
        }
      ]
    },
    {
      "name": "ec.fulfillment.change",
      "summary": "Fulfillment details changed",
      "description": "Merchant notifies host that checkout.fulfillment has changed (shipping method selected, destination updated).",
      "params": [
        {
          "name": "checkout",
          "required": true,
          "schema": {
            "$ref": "../../schemas/shopping/checkout_resp.json",
            "description": "Current checkout state with updated fulfillment."
          },
          "description": "Current checkout state with updated fulfillment."
        }
      ]
    },
    {
      "name": "ec.fulfillment.address_change_request",
      "summary": "Request address selection",
      "description": "Merchant requests host to present address selection UI for a shipping fulfillment method.",
      "params": [
        {
          "name": "checkout",
          "required": true,
          "schema": {
            "$ref": "../../schemas/shopping/checkout_resp.json",
            "description": "Current checkout state with fulfillment context."
          },
          "description": "Current checkout state with fulfillment context."
        }
      ],
      "result": {
        "name": "addressChangeResult",
        "schema": {
          "type": "object",
          "description": "Checkout state with updated fulfillment address.",
          "required": [
            "checkout"
          ],
          "properties": {
            "checkout": {
              "type": "object",
              "description": "Partial checkout update with fulfillment address selection.",
              "properties": {
                "fulfillment": {
                  "$ref": "../../schemas/shopping/types/fulfillment_resp.json",
                  "description": "Fulfillment with updated destinations and selected_destination_id."
                }
              }
            }
          }
        }
      }
    }
  ]
}
